{% extends 'webapp/base.html' %}

{% block content %}
<h5>Welcome, {{ user }}! ðŸ‘‹</h5>
<hr>
<!-- Create Record Button -->
<a class="btn btn-outline-primary btn-sm" href="{% url 'create-record' %}">
    Create a new record &nbsp; <i class="fa fa-plus-circle" aria-hidden="true"></i>
</a>
<hr> 

<!-- Search Form -->
<form id="searchForm" method="GET" action="{% url 'dashboard' %}">
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Search by name..." name="search" value="{{ request.GET.search }}">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit">Search</button>
        </div>
    </div>
</form>

<!-- Display Records Table -->
<div id="records-container">
    {% include 'webapp/partials/records_list.html' %}
</div>

<!-- Pagination Controls -->
<div id="pagination-container">
    {% include 'webapp/partials/pagination.html' %}
</div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        function loadRecords(url) {
            $.ajax({
                url: url,
                type: 'get',
                dataType: 'json',
                success: function(data) {
                    $('#records-container').html(data.records_html);
                    $('#pagination-container').html(data.pagination_html);
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', status, error);
                }
            });
        }

        $('#searchForm').on('submit', function(e) {
            e.preventDefault();
            const query = $(this).serialize();
            const url = $(this).attr('action') + "?" + query;
            loadRecords(url);
        });

        $(document).on('click', '.pagination a', function(e) {
            e.preventDefault();
            const url = $(this).attr('href');
            loadRecords(url);
        });
    });
</script>
{% endblock %}
